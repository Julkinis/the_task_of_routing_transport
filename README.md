# the_task_of_routing_transport
The task of routing transport includes one depot and many geographically remote customers.

Для решения поставленной задачи мною было предложено видоизменение
классического алгоритма имитации отжига. Для этого в качестве начального решения был
выбран набор маршрутов, полученный применением алгоритма Кларка-Райта к задаче, и
уменьшение температуры нагрева в 2 раза. В остальном алгоритм остался без изменений.

Алгоритм Кларка-Райта.
1 Класс Node используется для хранения узла клиента, включает в себя:
– id
– координаты расположения клиента
– ребро от депо к клиенту, ребро от клиента в депо
– маршрут автомобиля
– обслуживающего данного клиента и объем запрашиваемого товара
2 Edge — класс для хранения ребра, включает в себя:
– узел начала и узел конца
– длину ребра
– обратное ребро
– функцию, позволяющую инвертировать ребро.
3 Класс Route хранит маршрут и выполняет множество функций, с ним связанных.
Включает:
– ребра маршрута
– его длину
– объем товара, необходимого для погрузки
– возможность удаления и добавления ребер
– слияние и удаление маршрутов
– инвертирование маршрута
– функции возврата первого и последнего клиента в маршруте

Важное условие:
Если вершины ребра с наибольшим сбережением оба являются началом маршрутов, в
которые входят, то один маршрут инвертируется, после чего происходит их слияние. К
общему маршруту добавляется стоимость перевозки по ребру, а объемы перевозки
маршрутов суммируются. Аналогично, если обе вершины являются концом маршрутов.
Но, когда одна вершина является концом, а другая началом маршрута, в который входит,
инвертирование не нужно.

Основные шаги и концепции, лежащие в основе этого алгоритма:
1
Процесс начинается с определенной начальной "температурой", которая служит
аналогией начального состояния системы. Высокая температура позволяет системе
принимать более широкий диапазон решений, включая потенциально худшие, с
целью избежать застревания в локальных минимумах. Параметры tmin и tmax задаются
произвольно и могут быть изменены.
2 Задается произвольное начальное состояние si
3 В начальный момент времени t1 = tmax
4 Пока ti > tmin выполняются следующие шаги:
  a. Выбирается новое состояние системы, которое может быть лучше или хуже
текущего. Принятие решения о переходе в новое состояние зависит от
вероятности, которая уменьшается со временем благодаря механизму
"охлаждения". Это позволяет алгоритму "выскользнуть" из локальных
минимумов и продолжить исследование пространства поиска. В своей
работе для изменения состояния системы (маршрута) я использую алгоритм
улучшения внутри маршрута 2-опт.
  b. Обновление параметров ∆E = E(sc) — E(si), где ∆E — приращение энергии,
E(sс) — энергия текущего состояния, E(si) — энергия предыдущего
состояния
  c.
Выбор следующего состояния. Алгоритм использует случайные операции
для выбора следующего состояния, что позволяет исследовать различные
области пространства поиска. Если ∆E ≥ 0, то xc = xi. Если ∆E < 0, то
переход осуществляется с вероятностью p=e(−∆E / t i ).
  d. Функция охлаждения контролирует скорость уменьшения вероятности
принятия худших решений. Она играет ключевую роль в балансировке между исследованием новых областей пространства поиска и эксплуатацией
уже найденных решений. ti = T, где T — закон убывания температуры,
скорость остывания может задаваться произвольно, что придает
значительную гибкость алгоритму. Со временем, когда система
"охлаждается", вероятность принятия худших решений уменьшается, что
приводит к тому, что алгоритм все больше склоняется к принятию лучших
решений, находящихся поблизости от текущего состояния.

Процесс продолжается до тех пор, пока система полностью "не остынет", то есть
пока не будет достигнута заданная минимальная температура или пока не будет
найдено достаточно хорошее решение.
Основные преимущества алгоритма имитации отжига включают его способность
избегать застревания в локальных минимумах и возможность применения к задачам с
большим количеством переменных. Однако, алгоритм также имеет свои недостатки, такие
как зависимость от начального решения и необходимость настройки параметров, таких
как начальная температура и коэффициент охлаждения, для достижения оптимальных
результатов. 

Алгоритм имитации отжига

Основные функции, присутствующие в коде программы:
1 heat — функция нагрева.
Принимает параметры:
– param – количество циклов нагрева (повторов применения алгоритма 2-опт для
изменения исходного маршрута);
– costs – расстояние между узлами (стоимость перевозки);
– m - количество транспортных средств;
– node_w – запрос клиента по объему поставки;
– old_path – исходное решение, то есть любое решение, заданное при
инициализации.
Возвращает начальную температуру T0 и новый путь.
2 new_paths – функция генерации нового пути. Для этого используется алгоритм 2-
opt.
Принимает параметры:
– старый путь.
Возвращает новый путь.
3 total_dis – функция подсчета длины маршрута.
Принимает параметры:
– costs – расстояние между узлами (стоимость перевозки);
– m - количество транспортных средств;
– path - путь, длина которого будет вычислена;
– node_w – запрос клиента по объему поставки.
Возвращает целевую функцию, то есть значение расстояния текущего пути + сумма
штрафных единиц. Штраф определяется как 0,1*Q, где Q – грузоподъемность
транспортных средств. Добавление штрафных санкций позволяет уменьшить
вероятность выбора нового пути, содержащего превышение по грузоподъемности.
Параметр 0,1 выбран неслучайно, он минимален и обеспечивает гибкость алгоритма, в
то же время остаточно большой для избежания ошибок.
4 metropolis – функция определяющая вероятность смены состояний.
Критерием Метрополиса является вероятность принятия нового решения в
моделируемом алгоритме отжига. Чтобы предотвратить попадание в локальное
оптимальное решение, необходимо принять новое решение с определенной
вероятностью.
Принимает параметры:
– old_path – старый путь;
– new_path – новый путь;
– costs – расстояние между узлами (стоимость перевозки);
– m - количество транспортных средств;
– node_w – запрос клиента по объему поставки;
– T – текущая температура при моделируемом внешнем цикле отжига.
Возвращает текущее оптимальное решение и соответствующую целевую функцию
(расстояние).
5 picture – функция, рисующая карту маршрутов.
Принимает координаты узлов и оптимизированный маршрут, цвета линий выбираются
рандомно.
